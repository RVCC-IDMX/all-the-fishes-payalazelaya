<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>All the Fishes</title>
  </head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.1.3/pixi.min.js"></script>
  <body>
    <script>
      // The app
      const app = new PIXI.Application({
        width: 740,
        height: 600,
        backgroundColor: 0x9dc6ff,
      });

      //Give us the view
      document.body.appendChild(app.view);

      // Fishes for Aquarium
      const my_sprite = PIXI.Sprite.from('img/fish.png');
      const my_sprite2 = PIXI.Sprite.from('img/fish.png');
      const my_sprite3 = PIXI.Sprite.from('img/angel_fish.png');
      const my_sprite4 = PIXI.Sprite.from('img/blue_fish.png');
      const my_sprite5 = PIXI.Sprite.from('img/tropical_fish.png');
      const my_sprite6 = PIXI.Sprite.from('img/colorful_fish.png');

      //Bubbles for Aquarium
      const bubble = PIXI.Sprite.from('img/bubble.png');
      const bubble2 = PIXI.Sprite.from('img/bubble.png');
      const bubble3 = PIXI.Sprite.from('img/bubble.png');
      const bubble4 = PIXI.Sprite.from('img/bubble.png');

      const bubbles = [bubble, bubble2, bubble3, bubble4];

      bubbles.forEach((bubble) => {
        bubble.scale.set(0.1);
        bubble.anchor.set(1);
        bubble.position.set(Math.random() * 650, Math.random() * 550);
      });

      //Scale the fishes
      my_sprite6.interactive = true;

      my_sprite.scale.set(1, 1);
      my_sprite2.scale.set(-0.5, 0.5);
      my_sprite3.scale.set(0.3, 0.3);
      my_sprite4.scale.set(-0.1, 0.1);
      my_sprite5.scale.set(0.2, 0.2);
      my_sprite6.scale.set(0.3, 0.3);

      // Position the fishes
      my_sprite.x = 100;
      my_sprite.y = 100;
      my_sprite2.x = 500;
      my_sprite2.y = 350;
      my_sprite3.x = 300;
      my_sprite3.y = 550;
      my_sprite4.x = 700;
      my_sprite4.y = 200;
      my_sprite5.x = 500;
      my_sprite5.y = 50;
      my_sprite6.x = 30;
      my_sprite6.y = 60;

      // Flip the fishes
      my_sprite2.anchor.set(1);
      my_sprite3.anchor.set(1);

      // Tint the fishes
      my_sprite2.tint = 0x8b4000;
      my_sprite3.tint = 0x0e86d4;
      my_sprite4.tint = 0xffff00;
      my_sprite5.tint = 0xffc0cb;
      my_sprite6.tint = 0xff0000;

      //Draggable event listeners
      let dragging = false;
      offsetX = 0;
      offsetY = 0;

      my_sprite6.on("pointerdown", (e) => {
        dragging = true;
        offsetX = my_sprite6.x - e.data.global.x;
        offsetY = my_sprite6.y - e.data.global.y;
      })

      my_sprite6.on("pointermove", (e) => {
        if (dragging) {
          my_sprite6.x = e.data.global.x + offsetX;
          my_sprite6.y = e.data.global.y + offsetY;
        }
      })

      my_sprite6.on("pointerup", (e) => {
        dragging = false; 
      })

      //Create fish container
      const my_container = new PIXI.Container();

      //Background
      const tank = PIXI.Sprite.from('img/fish_tank.png');
      tank.scale.set(1.55, 1.55);
      tank.x = 0;
      tank.y = 0;

      //Add fish plus bubbles to container
      my_container.addChild(tank);

      my_container.addChild(my_sprite);
      my_container.addChild(my_sprite2);
      my_container.addChild(my_sprite3);
      my_container.addChild(my_sprite4);
      my_container.addChild(my_sprite5);
      my_container.addChild(my_sprite6);

      my_container.addChild(bubble);
      my_container.addChild(bubble2);
      my_container.addChild(bubble3);
      my_container.addChild(bubble4);

      //Add fish and bubbles to stage
      app.stage.addChild(my_container);

      app.stage.addChild(my_sprite);
      app.stage.addChild(my_sprite2);
      app.stage.addChild(my_sprite3);
      app.stage.addChild(my_sprite4);
      app.stage.addChild(my_sprite5);
      app.stage.addChild(my_sprite6);

      app.stage.addChild(bubble);
      app.stage.addChild(bubble2);
      app.stage.addChild(bubble3);
      app.stage.addChild(bubble4);

      // Set up fish button
       function makeButton() {
        //Container for button
         let ourButton = new PIXI.Container();
         ourButton.interactive = true;
       

       //Create button body
       let buttonBody = new PIXI.Graphics();
       buttonBody.beginFill(0xaafeff);
       buttonBody.drawRoundedRect(0,0,220,70);
       ourButton.addChild(buttonBody);
       
       let buttonText = new PIXI.Text('Change the color of the biggest fish');
       buttonText.scale.set(.5);
       buttonText.anchor.set(.5);
       buttonText.position.set(buttonBody.width / 2, buttonBody.height / 2);
       buttonText.style.fontFamily = 'Calibri';
       buttonText.style.fill = 0x0000FF;
       buttonText.style.fontSize = '28px';
       ourButton.addChild(buttonText);

       ourButton.label = buttonText;
       ourButton.body = buttonBody;

       //Click Listener
       ourButton.on("pointertap", (e) => {
        my_sprite3.tint = 0xFFFFFF * Math.random();
       });

       //Hover Listener 
       ourButton.on("pointerover", (e) => {
        buttonBody.alpha = 0.9;
       });
       ourButton.on("pointerout", (e) => {
        buttonBody.alpha = 1;
       })

       return ourButton;
      }
      
      let button = makeButton();
      button.position.set(50, 10);
      app.stage.addChild(button);

      // Create slider 
      function makeSlider() {
        // create slider container
        let ourButton = new PIXI.Container();
        ourButton.interactive = true;

        // Value from 0.0 to 1.0
        ourButton.value = 0;

        // The track
        let theTrack = new PIXI.Graphics();
        theTrack.beginFill(0x1b3f94);
        theTrack.drawRect(0, -10, 200, 20);
        ourButton.addChild(theTrack);

        // The slide
        let theSlide = PIXI.Sprite.from("img/silly_fish.png");
        theSlide.interactive = true;
        theSlide.anchor.set(.5);
        theSlide.scale.set(.3);
        theSlide.position.set(10, -3);
        ourButton.addChild(theSlide)

        theSlide.dragging = false;

        theSlide.on("pointerdown", (e) => {
          theSlide.dragging = true;
        })

        theSlide.on("pointermove", (e) => {
          if (theSlide.dragging) {
            let newX = e.data.global.x - ourButton.getGlobalPosition().x;
            let newY = e.data.global.y - ourButton.getGlobalPosition().y;

            if (newX > theTrack.width) newX = theTrack.width;
            if (newX < 0 ) newX = 0;

            ourButton.value = newX/theTrack.width;
            theSlide.x = newX;
            my_sprite5.rotation = (ourButton.value * 50);
          }
        });
        
        theSlide.on("pointerup", (e) => {
          theSlide.dragging = false;
        })

        theSlide.on("pointerupoutside", (e) => {
          theSlide.dragging = false;
        })

        return ourButton;
      }

      let slider = makeSlider();
      slider.position.set (80,150);
      app.stage.addChild(slider);

      // Different wobbles for the fishies
      let loop = () => {
        let time = Date.now();
        let wobble = Math.sin(time / 350) * 40;
        let wobble2 = Math.sin(time / 500) * 40;
        let wobble3 = Math.sin(time / 200) * 20;

        my_sprite2.x = 700 + wobble;
        my_sprite4.x = 500 + wobble2;
        my_sprite6.x = 400 + wobble3;

        my_sprite.y = 550 + wobble;
        my_sprite3.y = 400 + wobble2;
        my_sprite5.y = 400 + wobble3;

        bubbles.forEach((bubble) => {
          bubble.position.x -= 1;

          if (bubble.position.x < 0) {
            bubble.position.x = 740;
            bubble.position.y = Math.random() * 600;
          }
        });

        requestAnimationFrame(loop);
      };

      loop();
    </script>
  </body>
</html>
